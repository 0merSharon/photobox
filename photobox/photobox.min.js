/*!
	photobox v1.4
	(c) 2012 Yair Even Or <http://dropthebit.com>

	based (~12%) on Picbox v2.2 from:
	(c) 2010 Ben Kay <http://bunnyfire.co.uk>

	Uses jQuery-mousewheel Version: 3.0.6
	(c) 2009 Brandon Aaron <http://brandonaaron.net>

	MIT-style license.
*/
(function(a,k){function Q(b){b.preventDefault();m.removeClass("active");m=a(this).parent().addClass("active");b=a.inArray(this,a(b.delegateTarget).data("a"));return B(b,0,1)}function H(b){b&&(d.src=I);a(d).css({transition:"0s"}).removeAttr("style");a(f).show().addClass("show");a(f).on("click","img",function(a){a.stopPropagation()});a(f).on(q,function(){a(d).addClass("zoomable");a(f).off(q).addClass("on")});C&&a(f).trigger("MSTransitionEnd");h.hideFlash&&a.each(["object","embed"],function(c,g){a(g).each(function(){b&& (this._picbox=this.style.visibility);this.style.visibility=b?"hidden":this._picbox})});a(k)[b?"on":"off"]({"keydown.photobox":R,"mousewheel.photobox":S});h.thumbs&&(m.removeAttr("class"),a(T).on("resize.photobox",J),J())}function J(){D=e[0].clientWidth;E=e[0].firstChild.clientWidth;e[E>D?"on":"off"]("mousemove",U)}function U(a){e[0].scrollLeft=a.pageX*(E/D)-500}function R(a){a=a.keyCode;var c=h.keys;return 0<=c.close.indexOf(a)&&F()||0<=c.next.indexOf(a)&&x("next")||0<=c.prev.indexOf(a)&&x("prev")|| !0}function x(b){if(a(pbOverlay).hasClass("hide"))return!1;b="pbPrevBtn"==this.id||"prev"==b?r:s;var c="both"==e.css("clear");return B(b,0,c)}function B(b,c,g){0<=b&&(t=b,y=j[b][0],r=(t||(h.loop?j.length:0))-1,s=(t+1)%j.length||(h.loop?0:-1),K(),a(f).addClass("pbLoading").removeClass("error"),!h.loop&&b==j.length-1?z.addClass("hide"):z.removeClass("hide"),!h.loop&&0==b?A.addClass("hide"):A.removeClass("hide"),h.thumbs&&(m.removeClass("active"),m=e.find("li").eq(b).addClass("active"),g||(g=m[0].offsetLeft+ m[0].clientWidth/2-l.clientWidth/2,c&&e.delay(800),!c&&e.stop(),e.animate({scrollLeft:g},500,"swing"))),0<=r&&(L.src=j[r][0]),0<=s&&(M.src=j[s][0]),h.counter&&u.find(".counter").text("( "+(t+1)+" / "+j.length+" )"),h.title&&u.find(".title").text(j[b][1]),a(d).siblings().hide(),n=new Image,n.onload=function(){var b=function(){a(d).css({transition:"0s"}).attr("class","prepare").hide().off(q);a(f).removeClass("hide");d.src=y;setTimeout(function(){a(d).removeAttr("style");setTimeout(function(){d.className= ""},0)},0)};c?b():(a(f).addClass("hide"),a(d).on(q,b),"0"==a(d).css("opacity")&&b());a(f).removeClass("pbLoading")},n.onerror=function(){a(f).removeClass("pbLoading").addClass("error");d.src=I;n.onerror=null},n.src=y);return!1}function S(b,c){var g=a(d).data("zoom")||1,N=d.getBoundingClientRect(),g=g+c/10;0.1>g&&(g=0.1);a(d).data("zoom",g).css({transform:"scale("+g+")"});if(N.height>l.clientHeight||N.width>l.clientWidth)a(k).on("mousemove.photobox",V);else a(k).off("mousemove.photobox"),d.style[v]= "50% 50%";return!1}function V(a){var c=100*((a.clientY/l.clientHeight*(l.clientHeight+200)-100)/l.clientHeight);a=(100*(a.clientX/l.clientWidth)).toFixed(2)+"% "+c.toFixed(2)+"%";d.style[v]=a}function K(){n.onload=function(){};n.src=L.src=M.src=y}function F(){function b(){a(f).removeClass("show hide on");a(d).removeAttr("class").removeAttr("src").removeAttr("style").off().data("zoom",1);W&&setTimeout(function(){a(f).hide()},200)}K();t=r=s=-1;a(document).off("mousemove");H();a(f).addClass("hide"); a(d).on(q,b);C&&b();setTimeout(b,500);return!1}function G(b){var c=b||window.event,g=[].slice.call(arguments,1),d=0,f=0,e=0;b=a.event.fix(c);b.type="mousewheel";c.wheelDelta&&(d=c.wheelDelta/120);c.detail&&(d=-c.detail/3);e=d;void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(e=0,f=-1*d);void 0!==c.wheelDeltaY&&(e=c.wheelDeltaY/120);void 0!==c.wheelDeltaX&&(f=-1*c.wheelDeltaX/120);g.unshift(b,d,f,e);return(a.event.dispatch||a.event.handle).apply(this,g)}var T=a(window),h,j=[],e,w,t=-1,y,r,s,l,q="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", C=!("placeholder"in document.createElement("input")),W=!!window.ActiveXObject,v,D,E,m=a(),I="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",n={},L=new Image,M=new Image,f,d,A,z,u,O={loop:!0,thumbs:!0,counter:!0,title:!0,hideFlash:!0,keys:{close:"27, 88, 67",prev:"37, 80",next:"39, 78"}};a(k).ready(function(){a(k.body).prepend(a([f=a('<div id="pbOverlay">').hide().on("click",F).append(a('<div class="pbLoader"><b></b><b></b><b></b></div>'),A=a('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click", x),z=a('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",x),imageWrap=a('<div class="imageWrap">').append(d=a("<img>")[0])[0],a('<div id="pbCloseBtn">').append("<b>\u00d7</b>").on("click",F)[0],u=a('<div id="pbCaption">').append('<div class="title">').append('<div class="counter">'))[0]]));a:{var b="transformOrigin",c,g=k.body.style,e=["ms","O","Moz","Webkit"];if(""==g[b])v=b;else{b=b[0].toUpperCase()+b.slice(1);for(c=e.length;c--;)if(""==g[e[c]+b]){v=e[c]+b;break a}v=void 0}}});a.photobox= function(b,c){h=a.extend(O,c||{});C&&a(f).addClass("msie");H(1);2>j.length&&u.find(".counter").remove();return B(b,!0)};a.fn.photobox=function(b){w=this;w=w.filter(function(){var a=this.firstElementChild||this.children[0];if(!a||!a.tagName||"img"!=a.tagName.toLowerCase())return!1;j.push([this.href,a.getAttribute("alt")||a.getAttribute("title")]);return!0});if(O.thumbs||b.thumbs){var c=w;e=a("<div>").addClass("pbThumbs");var d=a("<ul>").appendTo(e),h;c.each(function(){h=k.createElement("a");h.href= this.href;h.appendChild(a(this.children[0]).clone()[0]);a("<li>").append(h).appendTo(d)});e.appendTo(u);a(f).addClass("thumbs");e.on("click","a",Q).data("a",e.find("a"))}a(this.context).on("click",this.selector,function(c){c.preventDefault();2>j.length&&A.add(z).remove();l=k.documentElement;return a.photobox(a.inArray(this,w),b)});return this};var p=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var P=p.length;P;)a.event.fixHooks[p[--P]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a= p.length;a;)this.addEventListener(p[--a],G,!1);else this.onmousewheel=G},teardown:function(){if(this.removeEventListener)for(var a=p.length;a;)this.removeEventListener(p[--a],G,!1);else this.onmousewheel=null}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery,document);