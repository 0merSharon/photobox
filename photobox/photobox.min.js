/*!
	photobox v1.1
	(c) 2012 Yair Even Or <http://dropthebit.com>

	based (~12%) on Picbox v2.2 from:
	(c) 2010 Ben Kay <http://bunnyfire.co.uk>

	Uses jQuery-mousewheel Version: 3.0.6
	(c) 2009 Brandon Aaron <http://brandonaaron.net>

	MIT-style license.
*/
(function(a,l){function P(b){b.preventDefault();m.removeClass("active");m=a(this).parent().addClass("active");b=a.inArray(this,a(b.delegateTarget).data("a"));return C(b,0,1)}function H(b){b&&(e.src=I);a(e).css({transition:"0s"}).removeAttr("style");a(d).show().addClass("show");a(d).on("click","img",function(a){a.stopPropagation()});a(d).on(q,function(){a(e).addClass("zoomable");a(d).off(q).addClass("on")});x&&a(d).trigger("MSTransitionEnd");h.hideFlash&&a.each(["object","embed"],function(c,g){a(g).each(function(){b&& (this._picbox=this.style.visibility);this.style.visibility=b?"hidden":this._picbox})});a(l)[b?"on":"off"]({"keydown.photobox":Q,"mousewheel.photobox":R});h.thumbs&&(m.removeAttr("class"),a(S).on("resize.photobox",J),J())}function J(){D=f[0].clientWidth;E=f[0].firstChild.clientWidth;f[E>D?"on":"off"]("mousemove",T)}function T(a){f[0].scrollLeft=a.pageX*(E/D)-500}function Q(a){a=a.keyCode;var c=h.keys;return 0<=c.close.indexOf(a)&&F()||0<=c.next.indexOf(a)&&y("next")||0<=c.prev.indexOf(a)&&y("prev")|| !0}function y(b){if(a(pbOverlay).hasClass("hide"))return!1;b="pbPrevBtn"==this.id||"prev"==b?r:s;var c="both"==f.css("clear");return C(b,0,c)}function C(b,c,g){0<=b&&(t=b,z=j[b][0],r=(t||(h.loop?j.length:0))-1,s=(t+1)%j.length||(h.loop?0:-1),K(),a(d).addClass("pbLoading").removeClass("error"),!h.loop&&b==j.length-1?A.addClass("hide"):A.removeClass("hide"),!h.loop&&0==b?B.addClass("hide"):B.removeClass("hide"),h.thumbs&&(m.removeClass("active"),m=f.find("li").eq(b).addClass("active"),g||(g=m[0].offsetLeft+ m[0].clientWidth/2-k.clientWidth/2,c&&f.delay(800),!c&&f.stop(),f.animate({scrollLeft:g},500,"swing"))),0<=r&&(L.src=j[r][0]),0<=s&&(M.src=j[s][0]),h.counter&&u.find(".counter").text("( "+(t+1)+" / "+j.length+" )"),h.title&&u.find(".title").text(j[b][1]),a(e).siblings().hide(),n=new Image,n.onload=function(){var b=function(){a(e).css({transition:"0s"}).attr("class","prepare").hide().off(q);a(d).removeClass("hide");e.src=z;setTimeout(function(){a(e).removeAttr("style");setTimeout(function(){e.className= ""},0)},0)};c?b():(a(e).on(q,b),a(d).addClass("hide"),x&&b());a(d).removeClass("pbLoading")},n.onerror=function(){a(d).removeClass("pbLoading").addClass("error");e.src=I;n.onerror=null},n.src=z);return!1}function R(b,c){var g=a(e).data("zoom")||1,d=e.getBoundingClientRect(),g=g+c/10;0.1>g&&(g=0.1);a(e).data("zoom",g).css({transform:"scale("+g+")"});if(d.height>k.clientHeight||d.width>k.clientWidth)a(l).on("mousemove.photobox",U);else a(l).off("mousemove.photobox"),e.style[v]="50% 50%";return!1}function U(a){e.style[v]= 100*(a.clientX/k.clientWidth)+"% "+100*((a.clientY/k.clientHeight*(k.clientHeight+200)-100)/k.clientHeight)+"%"}function K(){n.onload=function(){};n.src=L.src=M.src=z}function F(){function b(){a(d).removeClass("show hide on");a(e).removeAttr("class").removeAttr("src").removeAttr("style").off().data("zoom",1);jQuery.browser.msie&&setTimeout(function(){a(d).hide()},200)}K();t=r=s=-1;a(document).off("mousemove");H();a(d).addClass("hide");a(e).on(q,b);x&&b();setTimeout(b,500);return!1}function G(b){var c= b||window.event,g=[].slice.call(arguments,1),d=0,e=0,f=0;b=a.event.fix(c);b.type="mousewheel";c.wheelDelta&&(d=c.wheelDelta/120);c.detail&&(d=-c.detail/3);f=d;void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(f=0,e=-1*d);void 0!==c.wheelDeltaY&&(f=c.wheelDeltaY/120);void 0!==c.wheelDeltaX&&(e=-1*c.wheelDeltaX/120);g.unshift(b,d,e,f);return(a.event.dispatch||a.event.handle).apply(this,g)}var S=a(window),h,j=[],f,w,t=-1,z,r,s,k,q="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",x=jQuery.browser.msie&& 10>a.browser.version,v,D,E,m=a(),I="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",n={},L=new Image,M=new Image,d,e,B,A,u,N={loop:!0,thumbs:!0,counter:!0,title:!0,hideFlash:!0,keys:{close:"27, 88, 67",prev:"37, 80",next:"39, 78"}};a(l).ready(function(){a(l.body).prepend(a([d=a('<div id="pbOverlay">').hide().on("click",F).append(a('<div class="pbLoader"><b></b><b></b><b></b></div>'),B=a('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",y),A=a('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click", y),imageWrap=a('<div class="imageWrap">').append(e=a("<img>")[0])[0],a('<div id="pbCloseBtn">').append("<b>\u00d7</b>").on("click",F)[0],u=a('<div id="pbCaption">').append('<div class="title">').append('<div class="counter">'))[0]]));a:{var b="transformOrigin",c,g=l.body.style,f=["ms","O","Moz","Webkit"];if(""==g[b])v=b;else{b=b[0].toUpperCase()+b.slice(1);for(c=f.length;c--;)if(""==g[f[c]+b]){v=f[c]+b;break a}v=void 0}}});a.photobox=function(b,c){h=a.extend(N,c||{});x&&a(d).addClass("msie");H(1); 2>j.length&&u.find(".counter").remove();return C(b,!0)};a.fn.photobox=function(b){w=this;w=w.filter(function(){if(!this.firstChild||!this.firstChild.tagName||"img"!=this.firstChild.tagName.toLowerCase())return!1;j.push([this.href,this.firstChild.getAttribute("alt")||this.firstChild.getAttribute("title")]);return!0});if(N.thumbs||b.thumbs){var c=w;f=a("<div>").addClass("pbThumbs");var e=a("<ul>").appendTo(f);f.appendTo(u);c.each(function(){a("<li>").append(a(this).clone()).appendTo(e)});a(d).addClass("thumbs"); f.on("click","a",P).data("a",f.find("a"))}a(this.context).on("click",this.selector,function(c){c.preventDefault();2>j.length&&B.add(A).remove();k=l.documentElement;return a.photobox(a.inArray(this,w),b)});return this};var p=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var O=p.length;O;)a.event.fixHooks[p[--O]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=p.length;a;)this.addEventListener(p[--a],G,!1);else this.onmousewheel=G},teardown:function(){if(this.removeEventListener)for(var a= p.length;a;)this.removeEventListener(p[--a],G,!1);else this.onmousewheel=null}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery,document);