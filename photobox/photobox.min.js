/*!
    photobox v1.7.2
    (c) 2012 Yair Even Or <http://dropthebit.com>

    Uses jQuery-mousewheel Version: 3.0.6 by:
    (c) 2009 Brandon Aaron <http://brandonaaron.net>

    MIT-style license.
*/
(function(c){function aa(a,b,h){1==b?(e.css({transform:"translateX(25%)",transition:".7s",opacity:0}),setTimeout(function(){r(y)},200)):-1==b&&(e.css({transform:"translateX(-25%)",transition:".7s",opacity:0}),setTimeout(function(){r(u)},200));1==h?g.addClass("show"):-1==h&&g.removeClass("show")}function M(a){var b,h=k.createElement("p").style,c=["ms","O","Moz","Webkit"];if(""==h[a])return a;a=a.charAt(0).toUpperCase()+a.slice(1);for(b=c.length;b--;)if(""==h[c[b]+a])return c[b]+a}function ba(a){a= a.keyCode;var b=d.keys;return 0<=b.close.indexOf(a)&&C()||0<=b.next.indexOf(a)&&r(u)||0<=b.prev.indexOf(a)&&r(y)||!0}function O(){r("pbPrevBtn"==this.id?y:u);return!1}function r(a,b,c){function N(){I.off(n).removeClass("change");d.counter&&D.find(".counter").text("("+(v+1)+" / "+l.length+")");d.title&&D.find(".title").text(l[v][1])}if(!a||0>a)a=0;f.addClass(a>v?"next":"prev");v=a;z=l[a][0];y=(v||(d.loop?l.length:0))-1;u=(v+1)%l.length||(d.loop?0:-1);P();f.removeClass("error");var g=setTimeout(function(){f.addClass("pbLoading")}, 50);d.loop||(Q[a==l.length-1?"addClass":"removeClass"]("hide"),R[0==a?"addClass":"removeClass"]("hide"));I.on(n,N).addClass("change");(b||p)&&N();d.thumbs&&q.changeActive(a,b,c);0<=y&&(S.src=l[y][0]);0<=u&&(T.src=l[u][0]);p&&f.addClass("hide");e.data("zoom",1);d.autoplay&&j.progress.reset();w=new Image;w.onload=function(){clearTimeout(g);var a=function(){e.off(n).css({transition:"none"});e[0].src=z;e[0].className="prepare";setTimeout(function(){e.removeAttr("style")[0].className="";f.removeClass("hide next prev"); setTimeout(function(){e[0].className="";e.on(n,U);p&&U()},0)},50)};f.removeClass("pbLoading").addClass("hide");e.removeAttr("style").removeClass("zoomable");if(b||p)a();else e.on(n,a)};w.onerror=function(){f.removeClass("pbLoading").addClass("error");e[0].src=V;w.onerror=null};w.src=z;E.save()}function U(){e.off(n);e.addClass("zoomable");m&&d.autoplay&&j.play();"function"==typeof F.callback&&F.callback()}function ca(a,b){var h=e.data("zoom")||1,d=e[0].getBoundingClientRect(),h=h+b/10;0.1>h&&(h=0.1); e.data("zoom",h).css({transform:"scale("+h+")"});if(d.height>s.clientHeight||d.width>s.clientWidth)c(k).on("mousemove.photobox",da);else c(k).off("mousemove.photobox"),e[0].style[W]="50% 50%";return!1}function ea(a,b){a.preventDefault();var c=F.thumbsList;c.css("height",c[0].clientHeight+10*b);c=D[0].clientHeight/2;G[0].style.cssText="margin-top: -"+c+"px; padding: "+c+"px 0;";g.hide().show(0);q.calc()}function da(a){var b=100*((a.clientY/s.clientHeight*(s.clientHeight+200)-100)/s.clientHeight);a= (100*(a.clientX/s.clientWidth)).toFixed(2)+"% "+b.toFixed(2)+"%";e[0].style[W]=a}function P(){clearTimeout(j.autoPlayTimer);c(k).off("mousemove.photobox");w.onload=function(){};w.src=S.src=T.src=z}function C(){function a(){""!=f[0].className&&(f.removeClass("show hide"),e.removeAttr("class").removeAttr("style").off().data("zoom",1),fa&&setTimeout(function(){f.hide()},200))}P();H.prototype.setup();E.clear();f.removeClass("on").addClass("hide");e.on(n,a);p&&a();setTimeout(a,500)}function J(a){var b= a||x.event,h=[].slice.call(arguments,1),d=0,f=0,e=0;a=c.event.fix(b);a.type="mousewheel";b.wheelDelta&&(d=b.wheelDelta/120);b.detail&&(d=-b.detail/3);e=d;void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(e=0,f=-1*d);void 0!==b.wheelDeltaY&&(e=b.wheelDeltaY/120);void 0!==b.wheelDeltaX&&(f=-1*b.wheelDeltaX/120);h.unshift(a,d,f,e);return(c.event.dispatch||c.event.handle).apply(this,h)}var k=document,x=window,H,A=[],F,d,l=[],v=-1,z,y,u,q,s,j,n="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", p=!("placeholder"in k.createElement("input")),fa=!!x.ActiveXObject,X="ontouchend"in k,K,L,t=c(),V="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",W=M("transformOrigin"),ga=M("transition"),w={},S=new Image,T=new Image,e,R,Q,D,I,m,g,G,ha={loop:!0,thumbs:!0,counter:!0,title:!0,autoplay:!1,time:3E3,history:!0,hideFlash:!0,zoomable:!0,keys:{close:"27, 88, 67",prev:"37, 80",next:"39, 78"}},f=c('<div id="pbOverlay">').hide().append(c('<div class="pbLoader"><b></b><b></b><b></b></div>'), G=c('<div class="imageWrap">').append(e=c("<img>"),R=c('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",O),Q=c('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",O)),c('<div id="pbCloseBtn">').on("click",C)[0],m=c('<div id="pbAutoplayBtn">').append(c('<div class="pbProgress">')),D=c('<div id="pbCaption">').append(I=c('<div class="pbCaptionText">').append('<div class="title"></div><div class="counter">'),g=c("<div>").addClass("pbThumbs")));c(k).ready(function(){p&&f.addClass("msie"); m.on("click",j.toggle);g.on("click","a",q.click);X&&g.css("overflow","auto");f.on("click","img",function(a){a.stopPropagation()});c(k.body).prepend(c(f));s=k.documentElement});c.fn.photobox=function(a,b,h){"string"!=typeof a&&(a="a");b=c.extend({},ha,b||{});a=new H(b,this,a);c(this).data("_photobox",a);a.callback=h;A.push(a);E.load();return this};H=function(a,b,h){this.options=c.extend({},a);this.target=h;this.selector=c(b||k);this.thumbsList=null;a=this.imageLinksFilter(b.find(h));this.imageLinks= a[0];this.images=a[1];this.init()};var Y=x.MutationObserver||x.WebKitMutationObserver,ia=x.addEventListener;H.prototype={init:function(){var a=this;this.options.thumbs&&(this.thumbsList=q.generate(this.imageLinks));this.selector.on("click.photobox",this.target,function(b){b.preventDefault();a.open(this)});this.observerTimeout=null;1==this.selector[0].nodeType&&a.observeDOM(a.selector[0],function(){clearTimeout(a.observerTimeout);a.observerTimeout=setTimeout(function(){var b=a.imageLinksFilter(a.selector.find(a.target)); a.imageLinks=b[0];a.images=b[1];a.thumbsList=q.generate(a.imageLinks)},50)})},open:function(a){var b=c.inArray(a,this.imageLinks);if(-1==b)return!1;d=this.options;l=this.images;F=this;this.setup(1);f.on(n,function(){f.off(n).addClass("on");r(b,!0)}).addClass("show");p&&f.trigger("MSTransitionEnd");return!1},imageLinksFilter:function(a){var b=[];return[a.filter(function(){var a=this.firstElementChild||this.children[0];if(!a||!a.tagName||"img"!=a.tagName.toLowerCase())return!1;b.push([this.href,a.getAttribute("alt")|| a.getAttribute("title")||""]);return!0}),b]},observeDOM:function(a,b){Y?(new Y(function(a){(a[0].addedNodes.length||a[0].removedNodes.length)&&b()})).observe(a,{childList:!0,subtree:!0}):ia&&(a.addEventListener("DOMNodeInserted",b,!1),a.addEventListener("DOMNodeRemoved",b,!1))},setup:function(a){var b=a?"on":"off";e[0].src=V;a?(e.css({transition:"0s"}).removeAttr("style"),f.show(),g.html(this.thumbsList),f[d.thumbs?"addClass":"removeClass"]("thumbs"),d.thumbs&&(t.removeAttr("class"),c(x).on("resize.photobox", q.calc),q.calc()),2>this.images.length?f.removeClass("thumbs hasArrows hasCounter hasAutoplay"):(f.addClass("hasArrows hasCounter"),1E3<d.time?(f.addClass("hasAutoplay"),d.autoplay?j.progress.start():j.pause()):f.removeClass("hasAutoplay"))):c(x).off("resize.photobox");d.hideFlash&&c.each(["object","embed"],function(b,d){c(d).each(function(){a&&(this._photobox=this.style.visibility);this.style.visibility=a?"hidden":this._photobox})});c(k)[b]({"keydown.photobox":ba});"ontouchstart"in document.documentElement&& (f.removeClass("hasArrows"),G[b]("swipe",aa));if(d.zoomable&&(G[b]({"mousewheel.photobox":ca}),!p))g[b]({"mousewheel.photobox":ea})},destroy:function(){this.selector.off("click.photobox",this.target).removeData("_photobox");C();return this.selector}};q={generate:function(a){var b=c("<ul>"),d,e=[],f,g=a.toArray().length,j;for(f=0;f<g;f++)d=a[f],j=d.children[0].title||d.children[0].alt||"",e.push('<li><a href="'+d.href+'"><img src="'+d.children[0].src+'" alt="" title="'+j+'" /></a></li>');b.html(e.join("")); return b},click:function(a){a.preventDefault();t.removeClass("active");t=c(this).parent().addClass("active");a=c(this.parentNode).index();return r(a,0,1)},changeActiveTimeout:null,changeActive:function(a,b,c){t.index();t.removeClass("active");t=g.find("li").eq(a).addClass("active");c||(clearTimeout(this.changeActiveTimeout),this.changeActiveTimeout=setTimeout(function(){var a=t[0].offsetLeft+t[0].clientWidth/2-s.clientWidth/2;b?g.delay(800):g.stop();g.animate({scrollLeft:a},500,"swing")},200))},calc:function(){K= g[0].clientWidth;L=g[0].firstChild.clientWidth;var a=L>K?"on":"off";!X&&g[a]("mousemove",q.move);return this},move:function(a){g[0].scrollLeft=a.pageX*(L/K)-500}};j={autoPlayTimer:!1,play:function(){j.autoPlayTimer=setTimeout(function(){r(u)},d.time);j.progress.start();m.removeClass("play");j.setTitle("Click to stop autoplay");d.autoplay=!0},pause:function(){clearTimeout(j.autoPlayTimer);j.progress.reset();m.addClass("play");j.setTitle("Click to resume autoplay");d.autoplay=!1},progress:{reset:function(){m.find("div").removeAttr("style"); setTimeout(function(){m.removeClass("playing")},200)},start:function(){p||m.find("div").css(ga,d.time+"ms");m.addClass("playing")}},setTitle:function(a){a&&m.prop("title",a+" (every "+d.time/1E3+" seconds)")},toggle:function(a){a.stopPropagation();j[d.autoplay?"pause":"play"]()}};var E={save:function(){"pushState"in window.history&&(decodeURIComponent(window.location.hash.slice(1))!=z&&d.history)&&window.history.pushState("photobox",k.title+"-"+l[v][1],window.location.pathname+window.location.search+ "#"+encodeURIComponent(z))},load:function(){if(d&&!d.history)return!1;var a=decodeURIComponent(window.location.hash.slice(1)),b,c;if(!a&&f.hasClass("show"))C();else for(b=0;b<A.length;b++)for(c in A[b].images)if(A[b].images[c][0]==a)return A[b].open(A[b].imageLinks[c]),!0},clear:function(){d.history&&"pushState"in window.history&&window.history.pushState("photobox",k.title,window.location.pathname+window.location.search)}},Z=window.onpopstate;window.onpopstate=function(a){Z&&Z.apply(this,arguments); "photobox"==a.state&&E.load()};var B=["DOMMouseScroll","mousewheel"];if(c.event.fixHooks)for(var $=B.length;$;)c.event.fixHooks[B[--$]]=c.event.mouseHooks;c.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=B.length;a;)this.addEventListener(B[--a],J,!1);else this.onmousewheel=J},teardown:function(){if(this.removeEventListener)for(var a=B.length;a;)this.removeEventListener(B[--a],J,!1);else this.onmousewheel=null}};c.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel", a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});c.event.special.swipe={setup:function(){c(this).bind("touchstart",c.event.special.swipe.handler)},teardown:function(){c(this).unbind("touchstart",c.event.special.swipe.handler)},handler:function(a){function b(){m.removeEventListener("touchmove",d);g=j=null}function d(e){e.preventDefault();var h=g-e.touches[0].pageX;e=j-e.touches[0].pageY;20<=Math.abs(h)?(b(),k=0<h?-1:1):20<=Math.abs(e)&&(b(),l=0<e?1:-1); a.type="swipe";f.unshift(a,k,l);return(c.event.dispatch||c.event.handle).apply(m,f)}var f=[].slice.call(arguments,1),e=a.originalEvent.touches,g,j,k=0,l=0,m=this;a=c.event.fix(a);1==e.length&&(g=e[0].pageX,j=e[0].pageY,this.addEventListener("touchmove",d,!1))}}})(jQuery);